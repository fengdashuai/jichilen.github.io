---
layout: post
title:  "Pyramid Mask Text Detector"
date:   2019-3-21
desc: "Pyramid Mask Text Detector"
keywords: "python"
categories: [Html]
tags: [reading,text,curve]
icon: icon-html
---

# Pyramid Mask Text Detector

这是商汤的有一个作品

上一个FOTS刷爆了很多记录，这一次并没有那么厉害。

这篇文章主要是针对mask rcnn在文字上面的运用提出了一些问题，然后在17mlt上面刷到了80.13%的fmeasure，比第二高了3个百分点。

这篇文章主要针对的是一个框架，提出了一些问题，这些问题主要都是针对文字的，然后提出了解决这些问题的方法，然后介绍了一些自己刷数据的操作，还是有借鉴意义的。

## MASK RCNN的在处理文字时候的基本问题

#### 过于简单的监督信息

mask rcnn具有很强大的性能，然而他产生的mask是一个任意形状的，这对于文字来说，有很多浪费的空间，或者说，我们直接将文字区域生成mask，等于将一个很强的先验信息抛弃了，因为文字一般都具有四边形的mask（mlt数据集下曲线文字比较少）。

#### 不准确的分割标签

将文字的四边形标注直接转换成一个二进制黑白图像能够直接运行maskrcnn，然而这种情况下的标签生成时让人不满意的，很多时候标注的标签并不能紧致的贴合文字，这也就导致了很多背景区域被包括到标签中，会导致最后分类器产生错误。

**这里就产生了一个问题**，如果pixel-level的标注能够获得的话，那么pixel-level的标注是否真的有作用，如果他能能够提高我们的分割结果那么能不能直接通过多任务学习变相的提高我们检测的结果。如果是这样的话，那么一个弱监督学习过程值得我们去实现？

#### 错误传播

maskrcnn为基准的检测器会先检测，然后在检测的bbox里面做分割，这样就存在一个问题，如果检测的结果就无法包围所有的文字，那么误差会继续积累至分割的分支。

为了解决上面三个问题，作者提出了一种解决思路，就是使用**软标签**，这种思路很类似现在的关键点检测Character Region Awareness for Text Detection中就是用了高斯作为标签生成的基本模式。为了配合这种软标签，作者又提出了一个测试用的算法，来在测试阶段利用软标签生成文字结果，并不知道这里为啥不用分水岭算法，之后继续看。

## 网络结构

整个网络的基本如下图所示

![PMTD_1](..\assets\img\PMTD_1.jpg)

这个是测试部分的流程图，因为训练部分基本没有变化，除了更换了一个标注以外。所以这篇文章充分的说明了以maskrcnn作为核心的检测器现在有多么厉害。即使PSE-Net那种在原理和检测结果上看起来没有什么挑剔的地方（看起来基本能够解决所有情况下问题）的检测器都不能在性能上和其pk。

![PMTD_2](..\assets\img\PMTD_2.jpg)

当然最为一个能够在榜上拿第一的工作，肯定不能这么简单，PMTD引入了一个后处理算法来解决mask-rcnn回归定位不准的问题，充分利用了box分支和mask分支的性能，mask分支的性能一直被低估了，特别是在文字检测上面，我之前也做过实验验证过这件事情。下面一个图充分体现了这种后处理算法的效果

![PMTD_2](..\assets\img\PMTD_3.jpg)

### 重要的tricks

#### 数据增强

随机水平翻转

多尺度训练，长宽在640-2560随机，不保留长宽比

随机crop 640x640区域

（后面两个也可以random crop然后reshape）

#### RPN-ANCHOR

fpn feature map  1/4; 1/8; 1/16; 1/32

aspect ratio   0:17; 0:44; 1:13; 2:90; 7:46

#### OHEM

### 标注产生

中心为金字塔顶端，高为1，然后底边为标注的mask这样每个位置垂线与金字塔的交点所对应的高即为软标注的值。



### 小结

这篇文章最值得注意的地方在于它真正站在文字的角度上来思考问题，虽然只做了一些微小的改动，并且只是做了一个数据集。但是当文字检测不再局限于通用目标检测的固定思路时才能真正很好的发展。

最近有一篇Tightness-aware Evaluation Protocol for Scene Text Detection就充分的考虑这些问题，虽然提出来的东西都不是很难， 但是对于文字检测意义非常巨大。